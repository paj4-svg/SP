let
    Start = [Data zlecenia],
    Koniec = [Data statusu],
    Status = [Status wniosku],
    GodzinaStart = #time(8, 0, 0),
    GodzinaKoniec = #time(16, 0, 0),
    // Odwołanie do Twojej tabeli ze świętami
    ListaSwiat = Swieta[Data], 

    Wynik = if Status <> "Zakończony pozytywnie" then null else 
    let
        // Sprawdzenie czy dzień jest roboczy
        CzyRoboczy = (d) => Date.DayOfWeek(d, Day.Monday) < 5 and not List.Contains(ListaSwiat, d),
        
        // Wygenerowanie listy dni od Start do Koniec
        ListaDni = List.Dates(Date.From(Start), Number.From(Date.From(Koniec) - Date.From(Start)) + 1, #duration(1,0,0,0)),
        DniRobocze = List.Select(ListaDni, each CzyRoboczy(_)),
        LiczbaDniRoboczych = List.Count(DniRobocze),

        // Obliczenia czasu
        CzasStart = Time.From(Start),
        CzasKoniec = Time.From(Koniec),

        // Logika dla tego samego dnia
        Suma = if LiczbaDniRoboczych = 0 then #duration(0,0,0,0)
               else if Date.From(Start) = Date.From(Koniec) then
                    let 
                        EfektywnyStart = List.Max({GodzinaStart, List.Min({GodzinaKoniec, CzasStart})}),
                        EfektywnyKoniec = List.Min({GodzinaKoniec, List.Max({GodzinaStart, CzasKoniec})})
                    in EfektywnyKoniec - EfektywnyStart
               else
                    let
                        // Czas w dniu rozpoczęcia
                        PierwszyDzien = if CzyRoboczy(Date.From(Start)) 
                                        then GodzinaKoniec - List.Max({GodzinaStart, List.Min({GodzinaKoniec, CzasStart})}) 
                                        else #duration(0,0,0,0),
                        // Czas w dniu zakończenia
                        OstatniDzien = if CzyRoboczy(Date.From(Koniec)) 
                                       then List.Min({GodzinaKoniec, List.Max({GodzinaStart, CzasKoniec})}) - GodzinaStart 
                                       else #duration(0,0,0,0),
                        // Pełne dni pomiędzy (bez pierwszego i ostatniego)
                        DniSrodkowe = List.Max({0, LiczbaDniRoboczych - (if CzyRoboczy(Date.From(Start)) then 1 else 0) - (if CzyRoboczy(Date.From(Koniec)) then 1 else 0)}),
                        CzasSrodkowy = #duration(0, DniSrodkowe * 8, 0, 0)
                    in
                        PierwszyDzien + CzasSrodkowy + OstatniDzien
    in 
        Suma
in
    Wynik
